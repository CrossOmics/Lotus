<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="API Reference" href="api/index.html"><link rel="prev" title="Lotus Documentation" href="index.html">
        <link rel="canonical" href="https://sizchode.github.io/Lotus/getting_started.html">

    <!-- Generated with Sphinx 8.1.3 and Furo 2025.09.25 -->
        <title>Quick Start - Lotus 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="_static/cards.css?v=73a4a0fb" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Lotus 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">Lotus 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Quick Start</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/index.html">API Reference</a><input aria-label="Toggle navigation of API Reference" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/workflows.html">Workflows Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/preprocess.html">Preprocessing Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/core_selection.html">Core Analysis Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/clustering.html">Clustering Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/visualization.html">Visualization Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/deg.html">Differential Expression Analysis Module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="citations.html">Citations</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/getting_started.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="quick-start">
<h1>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading">¶</a></h1>
<p>This guide will walk you through a complete single-cell RNA sequencing data analysis workflow, from data loading to final visualization results.</p>
<p>All example outputs shown below are <strong>real outputs</strong> from running <code class="docutils literal notranslate"><span class="pre">examples/lotus_workflow.py</span></code> with default parameters (<code class="docutils literal notranslate"><span class="pre">--clusters</span> <span class="pre">3</span> <span class="pre">--cells-per-cluster</span> <span class="pre">60</span></code>).</p>
<p>For a complete runnable example, see the <a class="reference external" href="https://github.com/CrossOmics/Lotus/blob/main/examples/lotus_workflow.py">lotus_workflow.py</a> script in the examples directory.</p>
<section id="lotus-analysis-pipeline">
<h2>Lotus Analysis Pipeline<a class="headerlink" href="#lotus-analysis-pipeline" title="Link to this heading">¶</a></h2>
<p>The standard Lotus analysis pipeline consists of the following steps in order:</p>
<ol class="arabic simple">
<li><p><strong>Load Data</strong> - Load single-cell data (AnnData format)</p></li>
<li><p><strong>Preprocessing</strong> - Quality control, filtering, normalization, HVG selection, scaling, PCA, and neighbor graph construction</p></li>
<li><p><strong>Core Analysis</strong> (optional, before clustering) - Identify core cells and compute core map embedding using cplearn</p></li>
<li><p><strong>Clustering</strong> - Cluster cells using cplearn (default), Leiden, or Louvain algorithms</p></li>
<li><p><strong>Visualization</strong> - Generate UMAP embeddings and visualization plots</p></li>
<li><p><strong>Differential Expression Analysis</strong> - Identify marker genes between clusters</p></li>
</ol>
<p><strong>Key Points:</strong></p>
<p>Core analysis is optional. It can be performed before clustering to identify stable cell populations, but clustering works without it. Clustering methods can be switched between cplearn (default), Leiden, and Louvain by changing the <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter. All methods are compatible, meaning cluster labels from any method can be used with subsequent visualization and DEG analysis functions. The pipeline is flexible, allowing you to use scanpy methods (Leiden/Louvain) or Lotus cplearn methods, and switch between them as needed.</p>
<p>First, import the necessary modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">lotus</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lotus.workflows</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">preprocess</span><span class="p">,</span>
    <span class="n">clustering</span><span class="p">,</span>
    <span class="n">umap</span><span class="p">,</span>
    <span class="n">marker_genes</span><span class="p">,</span>
    <span class="n">core_analysis</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">anndata</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnnData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</section>
<section id="load-data">
<h2>1. Load Data<a class="headerlink" href="#load-data" title="Link to this heading">¶</a></h2>
<p>Load your single-cell data. Lotus supports various data formats through anndata:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load from 10x Genomics H5 format</span>
<span class="c1"># adata = lt.read_10x_h5(&quot;path/to/data.h5&quot;)</span>

<span class="c1"># Or load from AnnData H5AD format</span>
<span class="c1"># adata = lt.read(&quot;path/to/data.h5ad&quot;)</span>

<span class="c1"># Or use scanpy&#39;s read functions</span>
<span class="c1"># import scanpy as sc</span>
<span class="c1"># adata = sc.read_10x_mtx(&quot;path/to/folder&quot;)</span>
</pre></div>
</div>
</section>
<section id="preprocessing">
<h2>2. Preprocessing<a class="headerlink" href="#preprocessing" title="Link to this heading">¶</a></h2>
<p>Preprocessing includes quality control, filtering, normalization, highly variable gene selection, scaling, PCA, and neighbor graph construction:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">preprocess</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="n">n_pcs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">target_sum</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span>
    <span class="n">n_top_genes</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
    <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="n">save_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This step performs quality control metrics (QC metrics) calculation, filters low-quality cells and genes, normalizes data and applies log transformation, selects highly variable genes (HVG), performs principal component analysis (PCA), and builds the neighbor graph.</p>
<p>After preprocessing, you can check the results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Preprocessing complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Data shape: </span><span class="si">{</span><span class="n">adata</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - PCA stored in: `adata.obsm[&#39;X_pca&#39;]` (shape: </span><span class="si">{</span><span class="n">adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;X_pca&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Latent representation stored in: `adata.obsm[&#39;X_latent&#39;]` (shape: </span><span class="si">{</span><span class="n">adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;X_latent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Raw counts saved in: `adata.layers[&#39;raw_counts&#39;]`&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Neighbors graph constructed: </span><span class="si">{</span><span class="n">adata</span><span class="o">.</span><span class="n">obsp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distances&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example output (from running <code class="docutils literal notranslate"><span class="pre">examples/lotus_workflow.py</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>2025-11-23 00:13:39,358 - INFO - ✓ Preprocessing complete
2025-11-23 00:13:39,358 - INFO -   - Data shape: (180, 50)
2025-11-23 00:13:39,358 - INFO -   - PCA stored in: `adata.obsm[&#39;X_pca&#39;]` (shape: (180, 20))
2025-11-23 00:13:39,358 - INFO -   - Latent representation stored in: `adata.obsm[&#39;X_latent&#39;]` (shape: (180, 32))
2025-11-23 00:13:39,358 - INFO -   - Raw counts saved in: `adata.layers[&#39;raw_counts&#39;]`
2025-11-23 00:13:39,358 - INFO -   - Neighbors graph constructed: True
</pre></div>
</div>
</section>
<section id="core-analysis-optional-before-clustering">
<h2>3. Core Analysis (optional, before clustering)<a class="headerlink" href="#core-analysis-optional-before-clustering" title="Link to this heading">¶</a></h2>
<p>Core analysis is an optional step that can be performed before clustering to identify core cells and compute core map embedding. The neighbors graph is already constructed in the preprocessing step:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Core analysis preparation (neighbors graph is already constructed in preprocessing)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Neighbors graph ready: </span><span class="si">{</span><span class="s1">&#39;neighbors&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using representation: adata.obsm[&#39;X_latent&#39;] (shape: </span><span class="si">{</span><span class="n">adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;X_latent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Neighbors graph ready: True
Using representation: adata.obsm[&#39;X_latent&#39;] (shape: (180, 32))
</pre></div>
</div>
<p>This step identifies core cells and computes core map embedding before clustering. The core analysis helps prepare the data for stable clustering by identifying stable cell populations.</p>
</section>
<section id="clustering">
<h2>4. Clustering<a class="headerlink" href="#clustering" title="Link to this heading">¶</a></h2>
<p>Lotus supports multiple clustering methods through a unified interface:</p>
<p><strong>Option A: Using Lotus cplearn (default)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">clustering</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cplearn&quot;</span><span class="p">,</span>  <span class="c1"># or omit for default</span>
    <span class="n">use_rep</span><span class="o">=</span><span class="s2">&quot;X_latent&quot;</span><span class="p">,</span>
    <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;cplearn_labels&quot;</span><span class="p">,</span>
    <span class="n">cluster_resolution</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
    <span class="n">print_summary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This method auto-detects the best representation (X_latent, X_pca, or X), generates stable clustering results, and outputs cluster labels to adata.obs.</p>
<p>Example output (from running <code class="docutils literal notranslate"><span class="pre">examples/lotus_workflow.py</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Initiating FlowRank with r= 10
Original average degree: 20.0
Cluster summary: 0: 60, 1: 60, 2: 60
2025-11-23 00:13:47,577 - INFO - ✓ Clustering complete
2025-11-23 00:13:47,577 - INFO -   - Cluster labels stored in: `adata.obs[&#39;cplearn_labels&#39;]`
2025-11-23 00:13:47,577 - INFO -   - Number of clusters: 3
2025-11-23 00:13:47,577 - INFO -   - Cluster IDs: [0, 1, 2]
</pre></div>
</div>
<p><strong>Option B: Using scanpy Leiden algorithm</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clustering</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span>
    <span class="n">cluster_resolution</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span>  <span class="c1"># auto-set if None</span>
<span class="p">)</span>

<span class="c1"># View clustering results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;leiden&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>Option C: Using scanpy Louvain algorithm</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clustering</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;louvain&quot;</span><span class="p">,</span>
    <span class="n">cluster_resolution</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;louvain&quot;</span><span class="p">,</span>  <span class="c1"># auto-set if None</span>
<span class="p">)</span>

<span class="c1"># View clustering results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;louvain&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>Switching between methods:</strong></p>
<p>You can easily switch between clustering methods in the same workflow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, try Leiden clustering</span>
<span class="n">clustering</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span> <span class="n">cluster_resolution</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">)</span>

<span class="c1"># Then try Louvain with different resolution</span>
<span class="n">clustering</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;louvain&quot;</span><span class="p">,</span> <span class="n">cluster_resolution</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;louvain&quot;</span><span class="p">)</span>

<span class="c1"># Compare results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Leiden clusters:&quot;</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;leiden&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Louvain clusters:&quot;</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;louvain&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="c1"># Use either cluster key for visualization</span>
<span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">cluster_key</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./results&quot;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;_leiden.png&quot;</span><span class="p">)</span>
<span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">cluster_key</span><span class="o">=</span><span class="s2">&quot;louvain&quot;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./results&quot;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;_louvain.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>All methods output cluster labels in scanpy-compatible format and can be used with subsequent Lotus functions.</p>
</section>
<section id="visualization">
<h2>5. Visualization<a class="headerlink" href="#visualization" title="Link to this heading">¶</a></h2>
<p>Generate UMAP visualization of clustering results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">umap</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="n">cluster_key</span><span class="o">=</span><span class="s2">&quot;cplearn_labels&quot;</span><span class="p">,</span>  <span class="c1"># Use &quot;leiden&quot; or &quot;louvain&quot; if using scanpy</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./results&quot;</span><span class="p">,</span>
    <span class="n">save</span><span class="o">=</span><span class="s2">&quot;_clusters.png&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This step computes UMAP dimensionality reduction and generates visualization plots of clustering results.</p>
<p>The visualization is saved as a PNG file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ UMAP visualization complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - UMAP embedding stored in: `adata.obsm[&#39;X_umap&#39;]` (shape: </span><span class="si">{</span><span class="n">adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;X_umap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Visualization saved to: ./results/umap_clusters.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example output (from running <code class="docutils literal notranslate"><span class="pre">examples/lotus_workflow.py</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>WARNING: saving figure to file figures/umap_clusters.png
2025-11-23 00:13:48,497 - INFO - ✓ UMAP visualization complete
2025-11-23 00:13:48,497 - INFO -   - UMAP embedding stored in: `adata.obsm[&#39;X_umap&#39;]` (shape: (180, 2))
2025-11-23 00:13:48,497 - INFO -   - Visualization saved to: /tmp/lotus_real_output/umap_clusters.png
</pre></div>
</div>
<p>The output file contains a UMAP plot colored by cluster labels, showing the cell type separation.</p>
<p>The visualization shows a UMAP embedding as a 2D representation of cells in the UMAP space, with color coding where each cluster is colored differently, and cell distribution that shows how cells are grouped and separated by cell type.</p>
<p>Example UMAP visualization:</p>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="_images/umap_clusters_example.png"><img alt="UMAP visualization colored by cluster labels" src="_images/umap_clusters_example.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">UMAP plot showing cell clusters. Each color represents a different cell type/cluster identified by the clustering algorithm. The plot displays cells in 2D UMAP space, with well-separated clusters indicating distinct cell types.</span><a class="headerlink" href="#id5" title="Link to this image">¶</a></p>
<div class="legend">
<p><em>To generate this image, run: ``python examples/lotus_workflow.py –clusters 3 –cells-per-cluster 60``, then copy ``result_</em>/umap_clusters.png`` to <a href="#id1"><span class="problematic" id="id2">``</span></a>docs/_static/umap_clusters_example.png``*</p>
</div>
</figcaption>
</figure>
<p>The UMAP plot shows the X-axis as UMAP dimension 1, the Y-axis as UMAP dimension 2, colors representing different clusters (e.g., cluster 0 in blue, cluster 1 in red, cluster 2 in green), points where each point represents a single cell, and separation where well-separated clusters indicate distinct cell types.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To generate the visualization images yourself, run the example script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>examples/lotus_workflow.py<span class="w"> </span>--clusters<span class="w"> </span><span class="m">3</span><span class="w"> </span>--cells-per-cluster<span class="w"> </span><span class="m">60</span>
</pre></div>
</div>
<p>This will create the UMAP plot (<code class="docutils literal notranslate"><span class="pre">umap_clusters.png</span></code>) and marker gene violin plot (<code class="docutils literal notranslate"><span class="pre">violin_markers.png</span></code>) in the output directory.</p>
<p>The generated PNG file (<code class="docutils literal notranslate"><span class="pre">./results/umap_clusters.png</span></code>) can be opened in any image viewer to see the visualization.</p>
</div>
</section>
<section id="differential-expression-analysis">
<h2>6. Differential Expression Analysis<a class="headerlink" href="#differential-expression-analysis" title="Link to this heading">¶</a></h2>
<p>Find marker genes between clusters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">de_result</span> <span class="o">=</span> <span class="n">marker_genes</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="n">cluster_key</span><span class="o">=</span><span class="s2">&quot;cplearn_labels&quot;</span><span class="p">,</span>  <span class="c1"># Use &quot;leiden&quot; or &quot;louvain&quot; if using scanpy</span>
    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;raw_counts&quot;</span><span class="p">,</span>
    <span class="n">auto_pick_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This step identifies differentially expressed genes between clusters, auto-selects comparison groups if not specified, and outputs a marker gene list.</p>
<p>Check the results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ DEG analysis complete&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Total differentially expressed genes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">de_result</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Significant genes (p_adj &lt; 0.05): </span><span class="si">{</span><span class="p">(</span><span class="n">de_result</span><span class="p">[</span><span class="s1">&#39;p_adj&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Significant genes (p_adj &lt; 0.01): </span><span class="si">{</span><span class="p">(</span><span class="n">de_result</span><span class="p">[</span><span class="s1">&#39;p_adj&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 differentially expressed genes:&quot;</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gene&#39;</span><span class="p">,</span> <span class="s1">&#39;log2fc&#39;</span><span class="p">,</span> <span class="s1">&#39;z_score&#39;</span><span class="p">,</span> <span class="s1">&#39;pvalue&#39;</span><span class="p">,</span> <span class="s1">&#39;p_adj&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_a&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_b&#39;</span><span class="p">,</span> <span class="s1">&#39;pct_expr_a&#39;</span><span class="p">,</span> <span class="s1">&#39;pct_expr_b&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">de_result</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
<p>Example output (from running <code class="docutils literal notranslate"><span class="pre">examples/lotus_workflow.py</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Comparing groups {0} vs {1}
2025-11-23 00:13:51,088 - INFO - ✓ DEG analysis complete
2025-11-23 00:13:51,088 - INFO -   - Total differentially expressed genes: 50
2025-11-23 00:13:51,088 - INFO -   - Significant genes (p_adj &lt; 0.05): 41
2025-11-23 00:13:51,088 - INFO -   - Significant genes (p_adj &lt; 0.01): 39
2025-11-23 00:13:51,088 - INFO -
Top 10 differentially expressed genes:
2025-11-23 00:13:51,091 - INFO -
    gene   log2fc   z_score       pvalue        p_adj   mean_a   mean_b  pct_expr_a  pct_expr_b
gene_002 2.187279 18.400315 2.021035e-20 3.368391e-19 6.666667 0.683333    1.000000    0.500000
gene_027 2.102686 19.505699 4.567841e-21 1.170854e-19 7.733333 1.033333    1.000000    0.600000
gene_021 2.078502 16.554285 4.683415e-21 1.170854e-19 9.700000 1.533333    1.000000    0.733333
gene_029 1.939962 12.955106 7.978928e-18 4.432738e-17 4.883333 0.533333    0.966667    0.366667
gene_032 1.911840 13.144602 6.643614e-18 4.152259e-17 5.083333 0.616667    0.966667    0.433333
gene_031 1.902821 15.913483 3.142358e-20 3.927948e-19 7.850000 1.366667    1.000000    0.750000
gene_045 1.866375 14.216678 6.965233e-19 4.975166e-18 6.900000 1.166667    1.000000    0.716667
gene_004 1.847075 14.939477 2.073976e-19 1.728313e-18 4.216667 0.450000    0.983333    0.350000
gene_023 1.603167 10.278753 1.255096e-15 4.827291e-15 4.316667 0.750000    0.983333    0.500000
gene_044 1.584963 12.506953 1.768928e-17 8.040582e-17 5.950000 1.316667    1.000000    0.666667
2025-11-23 00:13:51,093 - INFO -   - DEG results saved to: /tmp/lotus_real_output/deg_results.csv
</pre></div>
</div>
<p>The result is a pandas DataFrame containing gene names, log2 fold changes, z-scores, p-values, adjusted p-values, and expression statistics (mean expression in each group, percentage of cells expressing the gene).</p>
</section>
<section id="complete-example">
<h2>Complete Example<a class="headerlink" href="#complete-example" title="Link to this heading">¶</a></h2>
<p>Here’s a complete workflow example that you can run. For the full example script with logging and error handling, see <a class="reference external" href="https://github.com/CrossOmics/Lotus/blob/main/examples/lotus_workflow.py">lotus_workflow.py</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">lotus</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lotus.workflows</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">preprocess</span><span class="p">,</span>
    <span class="n">clustering</span><span class="p">,</span>
    <span class="n">umap</span><span class="p">,</span>
    <span class="n">marker_genes</span><span class="p">,</span>
    <span class="n">core_analysis</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Load your data (example with synthetic data)</span>
<span class="c1"># adata = lt.read(&quot;path/to/your/data.h5ad&quot;)</span>

<span class="c1"># 1. Preprocessing</span>
<span class="n">preprocess</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_pcs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">target_sum</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">n_top_genes</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">save_raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preprocessing complete. Data shape: </span><span class="si">{</span><span class="n">adata</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 2. Core Analysis (optional, before clustering)</span>
<span class="c1"># Skip this step if you don&#39;t need core analysis</span>
<span class="c1"># print(f&quot;Neighbors graph ready: {&#39;neighbors&#39; in adata.uns}&quot;)</span>
<span class="c1"># from lotus.methods.cplearn.external import cplearn</span>
<span class="c1"># model = cplearn.corespect(adata, use_rep=&quot;X_latent&quot;, key_added=&quot;cplearn&quot;)</span>
<span class="c1"># core_analysis(adata, model=model, key_added=&quot;X_cplearn_coremap&quot;)</span>
<span class="c1"># print(&quot;Core analysis complete&quot;)</span>

<span class="c1"># 3. Clustering</span>
<span class="c1"># Option 1: Using Leiden (scanpy)</span>
<span class="n">clustering</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span> <span class="n">cluster_resolution</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">key_added</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Leiden clustering complete. Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;leiden&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s2"> clusters&quot;</span><span class="p">)</span>

<span class="c1"># Option 2: Using Louvain (scanpy)</span>
<span class="c1"># clustering(adata, method=&quot;louvain&quot;, cluster_resolution=0.5, key_added=&quot;louvain&quot;)</span>
<span class="c1"># print(f&quot;Louvain clustering complete. Found {len(adata.obs[&#39;louvain&#39;].unique())} clusters&quot;)</span>

<span class="c1"># Option 3: Using cplearn (requires core analysis)</span>
<span class="c1"># from lotus.methods.cplearn.external import cplearn</span>
<span class="c1"># model = cplearn.corespect(adata, use_rep=&quot;X_latent&quot;, key_added=&quot;cplearn&quot;)</span>
<span class="c1"># clustering(adata, method=&quot;cplearn&quot;, use_rep=&quot;X_latent&quot;, key_added=&quot;cplearn_labels&quot;, cluster_resolution=1.2)</span>
<span class="c1"># print(f&quot;Cplearn clustering complete. Found {len(adata.obs[&#39;cplearn_labels&#39;].unique())} clusters&quot;)</span>

<span class="c1"># 4. Visualization</span>
<span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">cluster_key</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./results&quot;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;_clusters.png&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UMAP visualization saved to ./results/umap_clusters.png&quot;</span><span class="p">)</span>

<span class="c1"># 5. Differential Expression</span>
<span class="n">de_result</span> <span class="o">=</span> <span class="n">marker_genes</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">cluster_key</span><span class="o">=</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;raw_counts&quot;</span><span class="p">,</span> <span class="n">auto_pick_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEG analysis complete. Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">de_result</span><span class="p">)</span><span class="si">}</span><span class="s2"> differentially expressed genes&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Top 5 marker genes: </span><span class="si">{</span><span class="n">de_result</span><span class="p">[</span><span class="s1">&#39;gene&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✓ Analysis complete! Check ./results/ for output files.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example output (from running <code class="docutils literal notranslate"><span class="pre">examples/lotus_workflow.py</span></code>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>2025-11-23 00:13:35,955 - INFO - ============================================================
2025-11-23 00:13:35,955 - INFO - Lotus Workflow - Starting Analysis
2025-11-23 00:13:35,955 - INFO - ============================================================
2025-11-23 00:13:35,957 - INFO - Generated AnnData with shape (180, 50) and 50 genes.
2025-11-23 00:13:35,957 - INFO -
============================================================
2025-11-23 00:13:35,957 - INFO - Preprocessing Pipeline
2025-11-23 00:13:35,957 - INFO - ============================================================
2025-11-23 00:13:35,958 - INFO - Running complete preprocessing pipeline...
2025-11-23 00:13:39,358 - INFO - ✓ Preprocessing complete
2025-11-23 00:13:39,358 - INFO -   - Data shape: (180, 50)
2025-11-23 00:13:39,358 - INFO -   - PCA stored in: `adata.obsm[&#39;X_pca&#39;]` (shape: (180, 20))
2025-11-23 00:13:39,358 - INFO -   - Latent representation stored in: `adata.obsm[&#39;X_latent&#39;]` (shape: (180, 32))
2025-11-23 00:13:39,358 - INFO -   - Raw counts saved in: `adata.layers[&#39;raw_counts&#39;]`
2025-11-23 00:13:39,358 - INFO -   - Neighbors graph constructed: True
2025-11-23 00:13:39,358 - INFO -
============================================================
2025-11-23 00:13:39,358 - INFO - Clustering
2025-11-23 00:13:39,358 - INFO - ============================================================
2025-11-23 00:13:39,358 - INFO - Performing clustering analysis...
Initiating FlowRank with r= 10
Original average degree: 20.0
Cluster summary: 0: 60, 1: 60, 2: 60
2025-11-23 00:13:47,577 - INFO - ✓ Clustering complete
2025-11-23 00:13:47,577 - INFO -   - Cluster labels stored in: `adata.obs[&#39;cplearn_labels&#39;]`
2025-11-23 00:13:47,577 - INFO -   - Number of clusters: 3
2025-11-23 00:13:47,577 - INFO -   - Cluster IDs: [0, 1, 2]
2025-11-23 00:13:47,577 - INFO -
============================================================
2025-11-23 00:13:47,577 - INFO - Visualization: UMAP
2025-11-23 00:13:47,577 - INFO - ============================================================
2025-11-23 00:13:47,577 - INFO - Computing UMAP embedding and generating visualization...
WARNING: saving figure to file figures/umap_clusters.png
2025-11-23 00:13:48,497 - INFO - ✓ UMAP visualization complete
2025-11-23 00:13:48,497 - INFO -   - UMAP embedding stored in: `adata.obsm[&#39;X_umap&#39;]` (shape: (180, 2))
2025-11-23 00:13:48,497 - INFO -   - Visualization saved to: /tmp/lotus_real_output/umap_clusters.png
2025-11-23 00:13:48,497 - INFO -
============================================================
2025-11-23 00:13:48,497 - INFO - CoreAnalysis: Neighbors → CoreAnalysis
2025-11-23 00:13:48,497 - INFO - ============================================================
2025-11-23 00:13:48,497 - INFO - Computing core map embedding...
Total number of clusters= 3
[60, 52, 48]
Fitting GMM anchors: 100%|██████████| 3/3 [00:00&lt;00:00, 10.31it/s]
GMM time=0.292 seconds (corrected)
Shape of embedding after round 0 is (160, 32)
Shape of embedding after round 1 is (165, 32)
Shape of embedding after round 2 is (170, 32)
Shape of embedding after round 3 is (174, 32)
Shape of embedding after round 4 is (177, 32)
Shape of embedding after round 5 is (180, 32)
Stored anchored map embedding in `adata.obsm[&#39;X_cplearn_coremap&#39;]` (180/180 points assigned).
2025-11-23 00:13:51,072 - INFO - ✓ CoreAnalysis complete
2025-11-23 00:13:51,072 - INFO -   - Core map embedding stored in: `adata.obsm[&#39;X_cplearn_coremap&#39;]` (shape: (180, 32))
2025-11-23 00:13:51,072 - INFO -   - Assigned points: 180/180 (100.0%)
2025-11-23 00:13:51,072 - INFO -
============================================================
2025-11-23 00:13:51,072 - INFO - DEG: Marker Genes
2025-11-23 00:13:51,072 - INFO - ============================================================
2025-11-23 00:13:51,072 - INFO - Identifying differentially expressed genes (marker genes)...
Comparing groups {0} vs {1}
2025-11-23 00:13:51,088 - INFO - ✓ DEG analysis complete
2025-11-23 00:13:51,088 - INFO -   - Total differentially expressed genes: 50
2025-11-23 00:13:51,088 - INFO -   - Significant genes (p_adj &lt; 0.05): 41
2025-11-23 00:13:51,088 - INFO -   - Significant genes (p_adj &lt; 0.01): 39
2025-11-23 00:13:51,088 - INFO -
Top 10 differentially expressed genes:
2025-11-23 00:13:51,091 - INFO -
    gene   log2fc   z_score       pvalue        p_adj   mean_a   mean_b  pct_expr_a  pct_expr_b
gene_002 2.187279 18.400315 2.021035e-20 3.368391e-19 6.666667 0.683333    1.000000    0.500000
gene_027 2.102686 19.505699 4.567841e-21 1.170854e-19 7.733333 1.033333    1.000000    0.600000
gene_021 2.078502 16.554285 4.683415e-21 1.170854e-19 9.700000 1.533333    1.000000    0.733333
gene_029 1.939962 12.955106 7.978928e-18 4.432738e-17 4.883333 0.533333    0.966667    0.366667
gene_032 1.911840 13.144602 6.643614e-18 4.152259e-17 5.083333 0.616667    0.966667    0.433333
gene_031 1.902821 15.913483 3.142358e-20 3.927948e-19 7.850000 1.366667    1.000000    0.750000
gene_045 1.866375 14.216678 6.965233e-19 4.975166e-18 6.900000 1.166667    1.000000    0.716667
gene_004 1.847075 14.939477 2.073976e-19 1.728313e-18 4.216667 0.450000    0.983333    0.350000
gene_023 1.603167 10.278753 1.255096e-15 4.827291e-15 4.316667 0.750000    0.983333    0.500000
gene_044 1.584963 12.506953 1.768928e-17 8.040582e-17 5.950000 1.316667    1.000000    0.666667
2025-11-23 00:13:51,093 - INFO -   - DEG results saved to: /tmp/lotus_real_output/deg_results.csv
2025-11-23 00:13:51,093 - INFO -
============================================================
2025-11-23 00:13:51,093 - INFO - Visualization: Rendering all visualizations
2025-11-23 00:13:51,093 - INFO - ============================================================
WARNING: saving figure to file figures/umap_clusters.png
WARNING: saving figure to file figures/violin_markers.png
2025-11-23 00:13:51,487 - INFO -   - Moved violin_markers.png to output directory
2025-11-23 00:13:51,487 - INFO -   - Moved umap_clusters.png to output directory
2025-11-23 00:13:51,487 - INFO - ✓ All visualizations complete
2025-11-23 00:13:51,487 - INFO -   - UMAP clusters plot: /tmp/lotus_real_output/umap_clusters.png
2025-11-23 00:13:51,487 - INFO -   - Marker genes violin plot: /tmp/lotus_real_output/violin_markers.png
2025-11-23 00:13:51,487 - INFO -   - Top 5 marker genes visualized: gene_002, gene_027, gene_021, gene_029, gene_032
2025-11-23 00:13:51,487 - INFO -
============================================================
2025-11-23 00:13:51,487 - INFO - Workflow Summary
2025-11-23 00:13:51,487 - INFO - ============================================================
2025-11-23 00:13:51,487 - INFO - ✓ All results saved to: /private/tmp/lotus_real_output
2025-11-23 00:13:51,487 - INFO - ✓ Output directory: lotus_real_output
2025-11-23 00:13:51,487 - INFO -   - Log file: /tmp/lotus_real_output/workflow_20251123_001335.log
2025-11-23 00:13:51,487 - INFO -   - DEG results: /tmp/lotus_real_output/deg_results.csv
2025-11-23 00:13:51,487 - INFO -   - UMAP plot: /tmp/lotus_real_output/umap_clusters.png
2025-11-23 00:13:51,487 - INFO -   - Violin plot: /tmp/lotus_real_output/violin_markers.png
2025-11-23 00:13:51,487 - INFO - ============================================================
2025-11-23 00:13:51,487 - INFO - Workflow completed successfully!
2025-11-23 00:13:51,487 - INFO - ============================================================
</pre></div>
</div>
</section>
<section id="output-files">
<h2>Output Files<a class="headerlink" href="#output-files" title="Link to this heading">¶</a></h2>
<p>After running the complete workflow, you’ll find the following output files in the <code class="docutils literal notranslate"><span class="pre">./results/</span></code> directory: <code class="docutils literal notranslate"><span class="pre">umap_clusters.png</span></code> (UMAP visualization colored by cluster labels) and <code class="docutils literal notranslate"><span class="pre">deg_results.csv</span></code> (complete differential expression results, if saved).</p>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<p>See <a class="reference internal" href="api/index.html"><span class="doc">API Reference</span></a> for the complete API reference. Run the example script <code class="docutils literal notranslate"><span class="pre">examples/lotus_workflow.py</span></code> for a more detailed example with logging. View the complete example on GitHub: <a class="reference external" href="https://github.com/CrossOmics/Lotus/blob/main/examples/lotus_workflow.py">lotus_workflow.py</a>.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Lotus Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Quick Start</a><ul>
<li><a class="reference internal" href="#lotus-analysis-pipeline">Lotus Analysis Pipeline</a></li>
<li><a class="reference internal" href="#load-data">1. Load Data</a></li>
<li><a class="reference internal" href="#preprocessing">2. Preprocessing</a></li>
<li><a class="reference internal" href="#core-analysis-optional-before-clustering">3. Core Analysis (optional, before clustering)</a></li>
<li><a class="reference internal" href="#clustering">4. Clustering</a></li>
<li><a class="reference internal" href="#visualization">5. Visualization</a></li>
<li><a class="reference internal" href="#differential-expression-analysis">6. Differential Expression Analysis</a></li>
<li><a class="reference internal" href="#complete-example">Complete Example</a></li>
<li><a class="reference internal" href="#output-files">Output Files</a></li>
<li><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/sidebar.js?v=7786d821"></script>
    </body>
</html>